<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Design & Gallery</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body class="bg">
  <header class="topbar">
    <a class="brand" href="./index.html">← Home</a>
    <div class="right">
      <span id="userBadge" class="badge">login...</span>
      <button id="btnLogin" class="btn" type="button">Googleログイン</button>
      <img id="userAvatar" class="avatar hidden" alt="ユーザーアイコン" />
      <button id="btnLogout" class="btn" type="button">ログアウト</button>
    </div>
    <nav class="tabs">
      <button id="tabProfile" class="tab">プロフィール</button>
      <button id="tabDesign" class="tab active">デザイン</button>
      <button id="tabGallery" class="tab">ランキング</button>
      <button id="tabTimeline" class="tab">タイムライン</button>
    </nav>
  </header>

  <main class="container">
    <!-- DESIGN -->
    <section id="viewDesign" class="grid2">
      <div class="card">
        <h2>デザイン</h2>

        <div class="row">
          <label class="label" for="templateSelect">テンプレ（服）</label>
          <select id="templateSelect" class="select">
            <option value="assets/templates/tshirt.png">Tシャツ</option>
            <option value="assets/templates/hoodies.png">パーカー</option>
          </select>
          <button id="btnClear" class="btn" type="button">全消し</button>
        </div>

        <div class="canvasWrap">
          <canvas id="designCanvas" width="900" height="900"></canvas>
        </div>

        <div class="row">
          <input id="titleInput" class="input" maxlength="40" placeholder="作品タイトル（任意）" />
          <button id="btnPublish" class="btn primary" type="button">投稿する</button>
        </div>

        <p class="muted">
          操作：
          <span class="deviceDesktop">クリックで追加 / ドラッグで移動 / ホイールで拡大縮小 / Q,Eで回転 / Deleteで削除</span>
          <span class="deviceMobile">タップで選択 / ドラッグで移動 / 二本指で拡大縮小</span>
        </p>
        <div id="publishStatus" class="muted"></div>
      </div>

      <div class="card">
        <div class="panelHeader">
          <h2>調整</h2>
          <div class="panelActions">
            <button id="btnUndo" class="btn" type="button">戻す</button>
            <button id="btnRedo" class="btn" type="button">進める</button>
          </div>
        </div>
        <div class="panelTabs">
          <button id="panelStickerBtn" class="panelTab" type="button">ステッカー</button>
          <button id="panelDrawBtn" class="panelTab" type="button">手書き</button>
          <button id="panelTextBtn" class="panelTab active" type="button">文字</button>
        </div>

        <div id="panelText" class="panel">
          <div class="row">
            <label class="label" for="textInput">文字</label>
            <input id="textInput" class="input" maxlength="40" placeholder="入れたい文字" />

            <label class="label" for="textSize">サイズ</label>
            <input id="textSize" class="input" type="range" min="12" max="120" value="36" />
            <span id="textSizeValue" class="muted" style="min-width:36px;text-align:right;">36</span>

          <label class="label" for="textFont">フォント</label>
          <select id="textFont" class="select">
            <option value="Hiragino Maru Gothic ProN">Hiragino Maru Gothic</option>
            <option value="Yu Gothic">Yu Gothic</option>
            <option value="Meiryo">Meiryo</option>
            <option value="Noto Sans JP">Noto Sans JP</option>
            <option value="Yomogi">Yomogi</option>
            <option value="M PLUS Rounded 1c">M PLUS Rounded 1c</option>
            <option value="Zen Maru Gothic">Zen Maru Gothic</option>
            <option value="Kosugi Maru">Kosugi Maru</option>
            <option value="Georgia">Georgia</option>
          </select>

            <button id="btnAddText" class="btn" type="button">文字を追加</button>
          </div>

          <div class="row">
            <label class="label" for="textColor">色</label>
            <input id="textColor" class="input" type="color" value="#ffffff" />

            <label class="label" for="neonPreset">ネオン</label>
            <select id="neonPreset" class="select">
              <option value="">選択</option>
              <option value="#00f5ff">Neon Cyan</option>
              <option value="#39ff14">Neon Green</option>
              <option value="#ff2d95">Neon Pink</option>
              <option value="#b026ff">Neon Purple</option>
              <option value="#fff700">Neon Yellow</option>
            </select>

            <label class="label" for="textAngle">角度</label>
            <input id="textAngle" class="input" type="number" min="-180" max="180" value="0" />

            <label class="label" for="textDirection">横/縦</label>
            <select id="textDirection" class="select">
              <option value="horizontal">横書き</option>
              <option value="vertical">縦書き</option>
            </select>

            <button id="btnApplyText" class="btn" type="button">選択に反映</button>
          </div>

          <div class="row">
            <label class="label" for="textEffect">エフェクト</label>
            <select id="textEffect" class="select">
              <option value="none">なし</option>
              <option value="shadow">シャドウ</option>
              <option value="glow">グロウ</option>
            </select>

            <label class="label" for="textEffectColor">効果色</label>
            <input id="textEffectColor" class="input" type="color" value="#00f5ff" />

            <label class="label" for="textEffectBlur">強さ</label>
            <input id="textEffectBlur" class="input" type="range" min="0" max="60" value="18" />

            <label class="label" for="textStrokeColor">枠色</label>
            <input id="textStrokeColor" class="input" type="color" value="#000000" />

          <label class="label" for="textStrokeWidth">枠太さ</label>
          <input id="textStrokeWidth" class="input" type="range" min="0" max="12" value="0" />
          <span id="textStrokeWidthValue" class="muted" style="min-width:36px;text-align:right;">0</span>
          <span class="rowBreak" aria-hidden="true"></span>
          </div>
        </div>

        <div id="panelDraw" class="panel hidden">
          <div class="row">
            <label class="label" for="toolPen">ツール</label>
            <button id="toolPen" class="btn active" type="button">ペン</button>
            <button id="toolEraser" class="btn" type="button">消しゴム</button>

            <label class="label" for="penColor">ペン色</label>
            <input id="penColor" class="input" type="color" value="#3a2f26" />

            <label class="label" for="penSize">太さ</label>
            <input id="penSize" class="input" type="range" min="1" max="40" value="6" />
            <span id="penSizeValue" class="muted" style="min-width:36px;text-align:right;">6</span>

            <button id="btnClearDraw" class="btn" type="button">手書きを消す</button>
          </div>

          <div class="row">
            <label class="label" for="drawEffect">エフェクト</label>
            <select id="drawEffect" class="select">
              <option value="none">なし</option>
              <option value="shadow">シャドウ</option>
              <option value="glow">グロウ</option>
            </select>

            <label class="label" for="drawEffectColor">効果色</label>
            <input id="drawEffectColor" class="input" type="color" value="#00f5ff" />

            <label class="label" for="drawEffectBlur">強さ</label>
            <input id="drawEffectBlur" class="input" type="range" min="0" max="60" value="18" />

            <label class="label" for="drawStrokeColor">枠色</label>
            <input id="drawStrokeColor" class="input" type="color" value="#000000" />

            <label class="label" for="drawStrokeWidth">枠太さ</label>
            <input id="drawStrokeWidth" class="input" type="range" min="0" max="12" value="0" />
            <span id="drawStrokeWidthValue" class="muted" style="min-width:36px;text-align:right;">0</span>
            <span class="rowBreak" aria-hidden="true"></span>
          </div>
        </div>

        <div id="panelSticker" class="panel hidden">
          <h3 style="margin-top:6px;">使える素材（ステッカー）</h3>
          <div id="assetGrid" class="assetPicker"></div>
          <p class="muted">
            素材はこのフォルダに画像を追加すれば増やせます！<code>assets/stickers/</code>
          </p>
        </div>
      </div>
    </section>

    <!-- GALLERY -->
    <section id="viewGallery" class="hidden">
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <h2 style="margin:0;">ランキング（いいね順）</h2>
          <div class="row" style="margin:0;gap:8px;">
            <select id="rankFilter" class="select" aria-label="モビー別ランキング">
              <option value="all">すべて</option>
            </select>
            <button id="btnRefresh" class="btn" type="button">更新</button>
          </div>
        </div>
        <div id="galleryGrid" class="galleryGrid"></div>
        <div id="galleryStatus" class="muted"></div>
      </div>
    </section>
    <section id="viewTimeline" class="hidden">
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center;">
          <h2 style="margin:0;">タイムライン</h2>
          <div class="row" style="margin:0;gap:8px;">
            <select id="timelineFilter" class="select" aria-label="タイムラインフィルター">
              <option value="all">すべて</option>
            </select>
            <button id="btnTimelineRefresh" class="btn" type="button">更新</button>
          </div>
        </div>
        <div class="timelineTabs">
          <button id="timelineTabRecommend" class="tab active" type="button">おすすめ</button>
          <button id="timelineTabFollowing" class="tab" type="button">フォロー中</button>
        </div>
        <div class="timelinePanels">
          <div id="timelinePanelRecommend" class="timelineBox">
            <div id="timelineRecommend" class="galleryGrid"></div>
            <div id="timelineRecommendStatus" class="muted"></div>
          </div>
          <div id="timelinePanelFollowing" class="timelineBox hidden">
            <div id="timelineFollowing" class="galleryGrid"></div>
            <div id="timelineFollowingStatus" class="muted"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- PROFILE -->
    <section id="viewProfile" class="hidden">
      <div class="card profileCard">
        <div class="profileHeader">
          <div class="profileAvatarWrap">
            <div class="profileAvatarStage">
              <img id="profileAvatar" class="avatar profileAvatar" alt="プロフィール画像" />
              <button id="btnAvatar" class="btn avatarBtn" type="button">✎</button>
            </div>
          </div>
          <div class="profileMeta">
            <div class="profileIdRow">
              <span id="profileRankBadge" class="rankBadge small hidden" aria-label="ランキング"></span>
              <button id="profileUid" class="countBtn" type="button">id: -</button>
              <button id="idReset" class="btn iconMiniBtn" type="button" title="ID変更">✎</button>
              <span id="profileInviteCode" class="inviteCodeBadge hidden"></span>
              <button id="profileInviteCopy" class="btn iconMiniBtn inviteCopyBtn hidden" type="button" title="招待コードをコピー">⧉</button>
            </div>
            <div class="profileCounts">
              <button id="profileFollowingBtn" class="countBtn" type="button"><strong id="profileFollowingCount">0</strong> フォロー中</button>
              <button id="profileFollowersBtn" class="countBtn" type="button"><strong id="profileFollowersCount">0</strong> フォロワー</button>
            </div>
          </div>
        </div>

        <div class="profileBox">
          <div class="row">
            <label class="label" for="profileName">表示名</label>
            <input id="profileName" class="input" maxlength="32" placeholder="表示名" />
            <label class="label" for="profileBio">ひとこと</label>
            <textarea id="profileBio" class="input textarea" rows="3" maxlength="160" placeholder="自己紹介"></textarea>
            <button id="profileSave" class="btn primary" type="button">保存</button>
          </div>
          <div id="profileStatus" class="muted"></div>
        </div>

        <div class="profileBox">
          <div class="profileDesignsSection">
            <h3 class="profileListTitle">自分の投稿</h3>
            <div id="profileDesignsStatus" class="muted"></div>
            <div id="profileDesigns" class="profileDesigns"></div>
          </div>
        </div>

        <div class="profileLists hidden">
          <div>
            <h3 class="profileListTitle">フォロー中</h3>
            <div id="followingList" class="userList"></div>
          </div>
          <div>
            <h3 class="profileListTitle">フォロワー</h3>
            <div id="followersList" class="userList"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal -->
  <dialog id="modal" class="modal">
    <div class="modalInner">
      <button id="modalClose" class="iconBtn" type="button">×</button>
      <div id="modalBody"></div>
    </div>
  </dialog>

  <dialog id="profileModal" class="modal">
    <div class="modalInner">
      <button id="profileModalClose" class="iconBtn" type="button">×</button>
      <div id="profileModalBody"></div>
    </div>
  </dialog>

  <dialog id="followListModal" class="modal">
    <div class="modalInner">
      <button id="followListModalClose" class="iconBtn" type="button">×</button>
      <h3 id="followListTitle" style="margin:0 0 10px;"></h3>
      <div id="followListBody" class="userList"></div>
    </div>
  </dialog>

  <dialog id="nicknameModal" class="modal">
    <div class="modalInner">
      <h3 style="margin:0 0 8px;">ニックネーム登録</h3>
      <p class="muted" style="margin:0 0 12px;">ランキングやプロフィールに表示されます。</p>
      <div class="row" style="margin-top:0;">
        <input id="nicknameInput" class="input" maxlength="32" placeholder="ニックネーム" style="flex:1" />
        <button id="nicknameSave" class="btn primary" type="button">保存</button>
      </div>
      <div id="nicknameStatus" class="muted"></div>
    </div>
  </dialog>

  <dialog id="idModal" class="modal">
    <div class="modalInner">
      <button id="idModalClose" class="iconBtn" type="button">×</button>
      <h3 style="margin:0 0 8px;">ユーザーID登録</h3>
      <p class="muted" style="margin:0 0 12px;">ログイン後に必ず設定が必要です。英数字とアンダーバーのみ（3〜20文字）。</p>
      <div class="row" style="margin-top:0;">
        <input id="idInput" class="input" maxlength="20" placeholder="例: mobby_user01" style="flex:1" />
        <button id="idSave" class="btn primary" type="button">保存</button>
      </div>
      <div id="idStatus" class="muted"></div>
    </div>
  </dialog>

  <dialog id="avatarModal" class="modal">
    <div class="modalInner avatarModalInner">
      <button id="avatarModalClose" class="iconBtn" type="button">×</button>
      <div class="avatarModalBody">
        <iframe id="avatarFrame" src="avatar/index.html" title="アイコン作成" loading="lazy"></iframe>
      </div>
    </div>
  </dialog>

  <dialog id="termsModal" class="modal">
    <div class="modalInner termsModalInner">
      <button id="termsModalClose" class="iconBtn" type="button">×</button>
      <h3 style="margin:0 0 8px;">利用規約</h3>
      <p class="muted" style="margin:0 0 10px;">内容は一旦後で追加</p>
      <div id="termsContent" class="termsContent">
        <p>内容は一旦後で追加</p>
        <p>内容は一旦後で追加</p>
        <p>内容は一旦後で追加</p>
        <p>内容は一旦後で追加</p>
        <p>内容は一旦後で追加</p>
        <p>内容は一旦後で追加</p>
        <p>内容は一旦後で追加</p>
        <p>内容は一旦後で追加</p>
        <p>内容は一旦後で追加</p>
        <p>内容は一旦後で追加</p>
      </div>
      <label id="termsAgreeRow" class="termsAgreeRow hidden">
        <input id="termsAgree" type="checkbox" />
        <span>利用規約に同意します</span>
      </label>
      <button id="termsAccept" class="btn primary" type="button" disabled>同意して登録</button>
    </div>
  </dialog>

  <dialog id="inviteModal" class="modal">
    <div class="modalInner inviteModalInner">
      <button id="inviteModalClose" class="iconBtn" type="button">×</button>
      <h3 style="margin:0 0 8px;">招待コード</h3>
      <p class="muted" style="margin:0 0 10px;">初回連携時に入力できます。お持ちの方は入力してください。</p>
      <div class="row" style="margin-top:0;">
        <input id="inviteInput" class="input" maxlength="32" placeholder="例: MOBBY-2026" style="flex:1" />
        <button id="inviteSave" class="btn primary" type="button">保存</button>
        <button id="inviteSkip" class="btn" type="button">後で</button>
      </div>
      <div id="inviteStatus" class="muted"></div>
    </div>
  </dialog>

  <script type="module" src="js/app.js"></script>
</body>
</html>
